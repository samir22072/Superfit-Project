{% load static %}
<!--
<!DOCTYPE html>
<html lang="en">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanning PBL</title>
    <link rel="stylesheet" href="{% static 'users/css/scanning.css' %}">
    <link rel="shortcut icon" type="image/png" href="img/favicon6.png">
</head>
<body>
    <button onclick="redirect()">Done!</button>
    <div class="form-group">  
        <div class="camera">
            <video id="video">Video stream not available.</video>

            <h3>Click on "Take photo" to capture your photo.</h3>
            <button type="button" id="startbutton" class="btn btn-success" data-toggle="modal" data- 
            target="#modal-success">Take photo</button><br>
        </div>

        <canvas id="canvas" width="500" height="500"></canvas>        
        <script>
            (function() {
                // The width and height of the captured photo. We will set the
                // width to the value defined here, but the height will be
                // calculated based on the aspect ratio of the input stream.
            
                var width = 500;    // We will scale the photo width to this
                var height = 500;   // This will be computed based on the input stream
            
                // |streaming| indicates whether or not we're currently streaming
                // video from the camera. Obviously, we start at false.
            
                var streaming = false;
            
                // The various HTML elements we need to configure or control. These
                // will be set by the startup() function.
            
                var video = null;
                var canvas = null;
                var photo = null;
                var startbutton = null;
            
                function startup() {
                  video = document.getElementById('video');
                  canvas = document.getElementById('canvas');
                  photo = document.getElementById('photo');
                  startbutton = document.getElementById('startbutton');
                
                  navigator.mediaDevices.getUserMedia({video: true, audio: false})
                  .then(function(stream) {
                    video.srcObject = stream;
                    video.play();
                  })
                  .catch(function(err) {
                    console.log("An error occurred: " + err);
                  });
              
                  video.addEventListener('canplay', function(ev){
                    if (!streaming) {
                      height = video.videoHeight / (video.videoWidth/width);
                    
                      // Firefox currently has a bug where the height can't be read from
                      // the video, so we will make assumptions if this happens.
                    
                      if (isNaN(height)) {
                        height = width / (4/3);
                      }
                  
                      video.setAttribute('width', 340);
                      video.setAttribute('height', 300);
                      canvas.setAttribute('width', width);
                      canvas.setAttribute('height', height);
                      streaming = true;
                    }
                  }, false);
              
                  startbutton.addEventListener('click', function(ev){
                    takepicture();
                    ev.preventDefault();
                  }, false);
              
                  clearphoto();
                }
            
                // Fill the photo with an indication that none has been
                // captured.
            
                function clearphoto() {
                  var context = canvas.getContext('2d');
                  context.fillStyle = "#AAA";
                  context.fillRect(0, 0, canvas.width, canvas.height);
                
                  var data = canvas.toDataURL('image/png');
                }
            
                // Capture a photo by fetching the current contents of the video
                // and drawing it into a canvas, then converting that to a PNG
                // format data URL. By drawing it on an offscreen canvas and then
                // drawing that to the screen, we can change its size and/or apply
                // other changes before drawing it.
            
                function takepicture() {
                  var context = canvas.getContext('2d');
                  if (width && height) {
                    canvas.width = width;
                    canvas.height = height;
                    context.drawImage(video, 0, 0, width, height);
                
                    var data = canvas.toDataURL('image/jpeg');
                    
                    console.log(data)
                    var URL="{% url 'save_image' %}"
                    $.ajax({
  type: "POST",
  url: URL,
  data: data,
  
}); 
                }else {
                    clearphoto();
                  }
                }
            
                // Set up our event listener to run the startup process
                // once loading is complete.
                window.addEventListener('load', startup, false);
                
              })();
              function redirect(){
                  location.href="/thankyou"
                } 
          </script>
</body>
</html>
-->